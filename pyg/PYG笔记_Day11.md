# PYG笔记_Day11
# 第1节课
## 1.1 今日知识点
```
solr 分页查询
```
## 1.2 今日目标
```

```
## 1.3课程内容
### 1.3.1 .今日目标
**视频信息**
```
视频名称: 01.今日目标
视频时长: 03:20
```
**小节内容**
```
目标1：实现品优购价格区间筛选功能
目标2：实现搜索结果分页功能
目标3：理解多关键字搜索
目标4：实现搜索结果排序功能
目标5：实现隐藏品牌列表功能
目标6：实现搜索页与首页对接功能
目标7：完成更新索引库的功能

```
### 1.3.2 .价格区间过滤-需求
**视频信息**
```
视频名称: 02.价格区间过滤-需求
视频时长: 02:39
```
**小节内容**
```
思路
服务器传递的是 字符串 0-500
服务器端可以按照"-"拆分 拆分后转换成数字然后查询
```


### 1.3.3 .价格区间过滤-前端
**视频信息**
```
视频名称: 03.价格区间过滤-前端
视频时长: 07:16
```
**小节内容**
```
前端处理逻辑参考 分类或者品牌列表
```
### 1.3.4 .价格区间过滤-后端
**视频信息**
```
视频名称: 04.价格区间过滤-后端
视频时长: 10:17
```
**小节内容**
```java
//1.5按价格筛选.....
		if(!"".equals(searchMap.get("price"))){
			String[] price = ((String) searchMap.get("price")).split("-");
			if(!price[0].equals("0")){//如果区间起点不等于0
				Criteria filterCriteria=new Criteria("item_price").greaterThanEqual(price[0]);
				FilterQuery filterQuery=new SimpleFilterQuery(filterCriteria);
				query.addFilterQuery(filterQuery);				
			}		
			if(!price[1].equals("*")){//如果区间终点不等于*
				Criteria filterCriteria=new  Criteria("item_price").lessThanEqual(price[1]);
				FilterQuery filterQuery=new SimpleFilterQuery(filterCriteria);
				query.addFilterQuery(filterQuery);				
			}
        }

```
**补充**
```

```
### 1.3.5 .分页-后端
**视频信息**
```
视频名称: 05.分页-后端
视频时长: 09:11
```
**小节内容**
```java
// 这里第一个参数需要计算出来
query.setOffset((pageNo-1)*pageSize);//从第几条记录查询
query.setRows(pageSize);	

```
**补充**
```

```
### 1.3.6 .分页-前端-构建分页栏-1
**视频信息**
```
视频名称: 06.分页-前端-构建分页栏-1
视频时长: 09:38
```
**小节内容**
```

```
**补充**
```

```
### 1.3.7 .分页-前端-构建分页栏-2
**视频信息**
```
视频名称: 07.分页-前端-构建分页栏-2
视频时长: 12:27
```
**小节内容**

```
根据伪代码去写代码
当总页数小于等于5页,显示所有页码
1) 当页码小于等于3页
2) 当前页码大于总页数-2 显示后五页
3) 其他显示中间5条
```
**补充**
```

```
### 1.3.8 .分页-前端-页码查询
**视频信息**
```
视频名称: 08.分页-前端-页码查询
视频时长: 07:48
```
**小节内容**
```
上一页,下一页功能处理
点击时让页码+1 或者-1 ,但是当是第一页时或者最后一页时固定
```
### 1.3.9 .分页-前端-页码查询-2
**视频信息**
```
视频名称: 09.分页-前端-页码查询-2
视频时长: 06:00
```
**小节内容**
```

```
**补充**
```

```
### 1.3.10 .分页-前端-不可用样式
**视频信息**
```
视频名称: 10.分页-前端-不可用样式
视频时长: 07:17
```
**小节内容**
```

```
**补充**
```

```
### 1.3.11 .分页-前端-省略号
**视频信息**
```
视频名称: 11.分页-前端-省略号
视频时长: 11:29
```
**小节内容**
```

```
**补充**
```

```
### 1.3.12 .分页-前端-完善
**视频信息**
```
视频名称: 12.分页-前端-完善
视频时长: 09:12
```
**小节内容**
```
1) 当发起新的搜索是,页码初始化为1
2) 当页码小于等于5 时 前后的点都不显示处理
```
### 1.3.13 .多关键字搜索
**视频信息**
```
视频名称: 13.多关键字搜索
视频时长: 08:33
```
**小节内容**
```
1) solr 的默认搜索规则是:先分词,后根据分词后的结果查询
```
**补充**
```

```
### 1.3.14 .排序-后端
**视频信息**
```
视频名称: 14.排序-后端
视频时长: 07:31
```
**小节内容**
```
//1.7排序
		String sortValue= (String) searchMap.get("sort");//ASC  DESC  
		String sortField= (String) searchMap.get("sortField");//排序字段
		if(sortValue!=null && !sortValue.equals("")){  
			if(sortValue.equals("ASC")){
				Sort sort=new Sort(Sort.Direction.ASC, "item_"+sortField);
				query.addSort(sort);
			}
			if(sortValue.equals("DESC")){		
				Sort sort=new Sort(Sort.Direction.DESC, "item_"+sortField);
				query.addSort(sort);
			}			
		}

```
**补充**
```

```
### 1.3.15 .价格排序-前端
**视频信息**
```
视频名称: 15.价格排序-前端
视频时长: 05:34
```
```
网页特殊符号

https://blog.csdn.net/u013778905/article/details/53177042
```
### 1.3.16 .新品排序
**视频信息**
```
视频名称: 16.新品排序
视频时长: 09:32
```
**小节内容**
```
需要将数据库的更新时间同步至solr
```
**补充**
```

```
### 1.3.17 .销量排序与评价排序的思路
**视频信息**
```
视频名称: 17.销量排序与评价排序的思路
视频时长: 10:25
```
**小节内容**
```
按销量排序（实现思路）
（1）增加域item_salecount 用于存储每个SKU的销量数据
（2）编写定时器程序，用于更新每个SKU的销量数据（查询近1个月的销量数据，不是累计数据）
（3）定时器每天只需执行一次，可以设定为凌晨开始执行。
定时器可以使用spring task技术来实现，学员们自行百度。

与按销量排序思路基本相同，有一个细节需要注意：
评论分为好评、中评、差评，我们不能简单地将评论数相加，而是应该根据每种评论加权进行统计。比如好评的权重是3 ，中评的权重是1，而差评的权重是 -3，这样得出的是评价的综合得分。

```
**补充**
```

```
### 1.3.18 .隐藏品牌列表
**视频信息**
```
视频名称: 18.隐藏品牌列表
视频时长: 09:22
```
**小节内容**
```

```
**补充**
```

```
### 1.3.19 .搜索页与首页对接
**视频信息**
```
视频名称: 19.搜索页与首页对接
视频时长: 09:30
```
**小节内容**
```

```
**补充**
```

```
### 1.3.20 .更新索引库-实现思路
**视频信息**
```
视频名称: 20.更新索引库-实现思路
视频时长: 06:18
```
**小节内容**
```
1) 新增和修改时不更新,审核通过时更新
2) 删除时更新
```
**补充**
```

```
### 1.3.21 .更新索引库-审核后更新-代码实现
**视频信息**
```
视频名称: 21.更新索引库-审核后更新-代码实现
视频时长: 11:34
```
**小节内容**
```

```
**补充**
```

```
### 1.3.22 .更新索引库-审核后更新-测试
**视频信息**
```
视频名称: 22.更新索引库-审核后更新-测试
视频时长: 04:49
```
**小节内容**
```

```
**补充**
```

```
### 1.3.23 .更新索引库-删除商品同步
**视频信息**
```
视频名称: 23.更新索引库-删除商品同步
视频时长: 12:01
```
**小节内容**
```

```
**补充**
```

```
